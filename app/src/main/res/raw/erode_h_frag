#version 310 es
precision highp float;

// Input grayscale texture
uniform sampler2D uTexture;

// The width of a single texel (1.0 / texture_width)
uniform float texelWidth;

// Half-size of the structural element (kernel)
uniform int kernelSize;

in vec2 vTexCoord;
out vec4 fragColor;

/**
 * Performs a horizontal erosion pass.
 * Erosion shrinks bright areas by taking the minimum value
 * in the neighborhood defined by the kernel.
 */
void main() {
    float minVal = 1.0;

    // Iterate through the horizontal neighborhood
    for(int i = -kernelSize; i <= kernelSize; i++){
        // Sample the red channel and keep the minimum
        float v = texture(uTexture, vTexCoord + vec2(float(i) * texelWidth, 0.0)).r;
        minVal = min(minVal, v);
    }

    // Output the result as a grayscale color
    fragColor = vec4(minVal, minVal, minVal, 1.0);
}
